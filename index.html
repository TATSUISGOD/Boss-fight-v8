<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:15px}
button{font-size:16px;padding:12px 20px;margin:4px}
#tapBtn{font-size:26px;padding:28px 60px}
.hidden{display:none!important}
.boss{font-size:80px}
.player{font-size:60px}
.hp-bar{width:80%;height:18px;background:#333;margin:10px auto;border-radius:10px}
.hp{height:100%;background:red}
.overlay{
 position:fixed;inset:0;background:rgba(0,0,0,.9);
 display:flex;justify-content:center;align-items:center;
 font-size:26px;z-index:999;text-align:center
}
.lr{color:gold;font-weight:bold}
.ur{color:#ffd700}
.hr{color:#ff9966}
.spin{font-size:80px;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.cut{
 animation:flash .4s alternate 6;
}
@keyframes flash{
 from{background:#000}
 to{background:#400}
}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>
<p>ğŸ’° <span id="coin"></span> / ğŸ’ <span id="dia"></span></p>
<p>âš” æ”»æ’ƒåŠ› +<span id="atk"></span></p>
<div class="player" id="player">ğŸ™‚</div>

<button onclick="drawGacha()">ğŸ°</button>
<button onclick="drawGacha10()">ğŸ°10</button>
<button onclick="drawDiaGacha()">ğŸ’</button>
<button onclick="drawDiaGacha10()">ğŸ’10</button>
<br>
<input id="diaInput" type="number" min="1" placeholder="ğŸ’æ•°">
<button onclick="exchangeDia()">äº¤æ›</button>
<button onclick="showDex()">ğŸ“–</button>

<hr>

<button onclick="startRush()">ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ ğŸ”¥</button>

<div id="select">
<h3>ãƒœã‚¹é¸æŠ</h3>
<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ã‚ªãƒ¼ã‚¯',300,'ğŸ‘¹',20)">ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',800,'ğŸ‰',50)">ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('ç¥ç«œ',5000,'ğŸ²âœ¨',500)">ç¥ç«œ</button>
<button onclick="startBattle('ç ´å£Šç¥',30000,'ğŸ’€',3000)">ç ´å£Šç¥</button>
<button onclick="startBattle('è™šç„¡ç‹',100000,'ğŸ‘',10000)">è™šç„¡ç‹</button>
<button onclick="startBattle('çµ‚ç„‰',300000,'ğŸŒ‘',50000)">çµ‚ç„‰</button>
</div>

<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP <span id="hpText"></span></p>
<button id="tapBtn">æ”»æ’ƒ</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<audio id="bgm" loop src="https://cdn.pixabay.com/audio/2022/03/15/audio_5c2e0a71d5.mp3"></audio>
<audio id="rareSE" src="https://cdn.pixabay.com/audio/2022/03/10/audio_c8c8a73467.mp3"></audio>

<script>
let coin=+localStorage.getItem("coin")||0;
let dia=+localStorage.getItem("dia")||0;
let atk=+localStorage.getItem("atk")||0;
let dex=JSON.parse(localStorage.getItem("dex")||"{}");

const coinEl=coinSpan=document.getElementById("coin");
const diaEl=document.getElementById("dia");
const atkEl=document.getElementById("atk");
const overlay=document.getElementById("overlay");
const bgm=document.getElementById("bgm");
const rareSE=document.getElementById("rareSE");

function save(){
 localStorage.setItem("coin",coin);
 localStorage.setItem("dia",dia);
 localStorage.setItem("atk",atk);
 localStorage.setItem("dex",JSON.stringify(dex));
 coinEl.textContent=coin;
 diaEl.textContent=dia;
 atkEl.textContent=atk.toFixed(1);
}
save();

function cutIn(text){
 overlay.innerHTML=`<div class="cut">${text}</div>`;
 overlay.classList.remove("hidden");
 rareSE.play();
 setTimeout(()=>overlay.classList.add("hidden"),1200);
}

function gachaAnim(cb){
 overlay.innerHTML='<div class="spin">ğŸ°</div>';
 overlay.classList.remove("hidden");
 bgm.play();
 setTimeout(()=>{
  overlay.classList.add("hidden");
  cb();
 },1200);
}

function normalRoll(){
 const r=Math.random()*100;
 if(r<2)return["LR",1.5,"lr"];
 if(r<7)return["UR",1,"ur"];
 if(r<22)return["HR",0.5,"hr"];
 return["R",0.1];
}

function drawGacha(){
 if(coin<100)return;
 coin-=100;save();
 gachaAnim(()=>{
  const g=normalRoll();
  atk+=g[1];
  dex[g[0]]=(dex[g[0]]||0)+1;
  save();
  if(g[0]==="UR"||g[0]==="LR")cutIn("âœ¨ "+g[0]+" âœ¨");
 });
}

function drawGacha10(){
 if(coin<1000)return;
 coin-=1000;save();
 gachaAnim(()=>{
  for(let i=0;i<10;i++){
   const g=normalRoll();
   atk+=g[1];
   dex[g[0]]=(dex[g[0]]||0)+1;
  }
  save();
  cutIn("ğŸ‰ 10é€£å®Œäº†ï¼");
 });
}

function drawDiaGacha(){
 if(dia<1)return;
 dia--;save();
 gachaAnim(()=>{
  const r=Math.random()*100;
  let g;
  if(r<15)g=["DIVINE",10];
  else if(r<60)g=["UR",1];
  else g=["LR",1.5];
  atk+=g[1];
  dex[g[0]]=(dex[g[0]]||0)+1;
  save();
  cutIn("ğŸ’ "+g[0]);
 });
}

function drawDiaGacha10(){
 if(dia<10)return;
 dia-=10;save();
 gachaAnim(()=>{
  for(let i=0;i<10;i++){
   const r=Math.random()*100;
   let g=r<15?["DIVINE",10]:r<60?["UR",1]:["LR",1.5];
   atk+=g[1];
   dex[g[0]]=(dex[g[0]]||0)+1;
  }
  save();
  cutIn("ğŸ’10é€£ï¼");
 });
}

function exchangeDia(){
 const n=+diaInput.value;
 if(!Number.isInteger(n)||n<=0)return;
 if(coin<n*1000)return;
 coin-=n*1000;dia+=n;save();
}

let bossHp,maxHp,reward,startTime;

function startBattle(n,h,i,r){
 document.getElementById("select").classList.add("hidden");
 document.getElementById("game").classList.remove("hidden");
 bossName.textContent=n;
 bossIcon.textContent=i;
 bossHp=maxHp=h;reward=r;
 startTime=Date.now();
 updateHp();
}

function updateHp(){
 hpText.textContent=Math.ceil(bossHp);
 hp.style.width=(bossHp/maxHp*100)+"%";
}

tapBtn.onclick=()=>{
 bossHp-=1+atk;
 if(bossHp<=0){
  coin+=reward;save();
  document.getElementById("game").classList.add("hidden");
  document.getElementById("select").classList.remove("hidden");
 }
 updateHp();
};

function startRush(){
 overlay.innerHTML="ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥é–‹å§‹ ğŸ”¥";
 overlay.classList.remove("hidden");
 setTimeout(()=>overlay.classList.add("hidden"),1000);
}
</script>
</body>
</html>
